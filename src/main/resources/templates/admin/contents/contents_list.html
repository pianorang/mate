<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/default">
<head>
  <!-- Page level plugins -->
  <style>
        .grid-item{
            margin-bottom: 10px;
        }
    </style>
  <link href="/vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
  <script src="/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="/vendor/datatables/dataTables.bootstrap4.min.js"></script>

  <link href="/js/fine-uploader/fine-uploader-new.css" rel="stylesheet">
  <script src="/js/fine-uploader/fine-uploader.min.js"></script>

  <script src="/js/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="/js/masonry/masonry.pkgd.min.js"></script>

  <script src="/js/twbs-pagination/jquery.twbsPagination.min.js"></script>


  <!-- Page level custom scripts -->
</head>
<body>
<div class="container-fluid" layout:fragment="content">
  <!-- Page Heading -->

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <div class="d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
        <!--begin::Info-->
        <div class="d-flex align-items-center flex-wrap mr-2">

          <!--begin::Page Title-->
          <h6 class="m-0 mr-3 font-weight-bold text-primary">Content</h6>
          <!--end::Page Title-->

          <!--begin::Actions-->
          <div class="subheader-separator subheader-separator-ver mt-2 mb-2 mr-4 bg-gray-200"></div>

          <a href="/client/new" class="btn btn-success btn-sm" data-toggle="modal" data-target="#addDefaultModal">
            <span class="text">Add New</span>
          </a>

          <!--end::Actions-->
        </div>
        <!--end::Info-->
      </div>

    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Type</th>
            <th>Thumbnail</th>
            <th>Duration</th>
            <th>Size</th>
            <th>Row Menu</th>
          </tr>
          </thead>

        </table>
      </div>

      <!--<div id="contentList" class="row text-center text-lg-left mt-3">
      </div>-->
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal fade" id="addDefaultModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <div id="fine-uploader">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!--<button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div class="modal fade" id="deleteRowModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Delete Row</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Delete ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary close" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger delete">Delete</button>
        </div>
      </div>
    </div>
  </div>
  <script type="text/template" id="qq-template">
    <div class="qq-uploader-selector qq-uploader" qq-drop-area-text="Drop files here">
      <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
      </div>
      <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
        <span class="qq-upload-drop-area-text-selector"></span>
      </div>
      <div class="qq-upload-button-selector qq-upload-button">
        <div>Upload a file</div>
      </div>
      <span class="qq-drop-processing-selector qq-drop-processing">
                <span>Processing dropped files...</span>
                <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
            </span>
      <ul class="qq-upload-list-selector qq-upload-list" aria-live="polite" aria-relevant="additions removals">
        <li>
          <div class="qq-progress-bar-container-selector">
            <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
          </div>
          <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
          <span class="qq-upload-file-selector qq-upload-file"></span>
          <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
          <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
          <span class="qq-upload-size-selector qq-upload-size"></span>
          <button type="button" class="qq-btn qq-upload-cancel-selector qq-upload-cancel">Cancel</button>
          <button type="button" class="qq-btn qq-upload-retry-selector qq-upload-retry">Retry</button>
          <button type="button" class="qq-btn qq-upload-delete-selector qq-upload-delete">Delete</button>
          <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
        </li>
      </ul>

      <dialog class="qq-alert-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">Close</button>
        </div>
      </dialog>

      <dialog class="qq-confirm-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">No</button>
          <button type="button" class="qq-ok-button-selector">Yes</button>
        </div>
      </dialog>

      <dialog class="qq-prompt-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <input type="text">
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">Cancel</button>
          <button type="button" class="qq-ok-button-selector">Ok</button>
        </div>
      </dialog>
    </div>
  </script>

  <script>
        var _PAGE=0;
        var $mainGrid;
        var $contentList = $('#contentList');
        var $masonryGrid;

        function getContentList(){

            $.ajax({
                url:'/admin/api/content',
                contentType:'json',
                data:{
                    page: _PAGE,
                    draw: _PAGE,
                    length: 20
                },
                success:function(d){
                    var html = '';
                    for (var i = 0; i < d.data.length; i++) {
                        var item = d.data[i];
                        html += '<div class="grid-item">';
                        // html += '<div class="form-check">\n' +
                        //     '<label class="form-check-label">\n' +
                        //     '<input class="form-check-input" type="checkbox" value="">\n' +
                        //     '<span class="form-check-sign">\n' +
                        //     '<span class="check"></span>\n' +
                        //     '</span>\n' +
                        //     '</label>\n' +
                        //     '</div>';
                        //html += '<a href="#" class="" style="display: block;">';
                        html += '<img class="" src="/upload'+ item.thumbnailPath +'" alt="'+ item.originalFilename +'">';
                        //html += '</a>';
                        html += '</div>';
                    }

                    $contentList.html(html);
                    if ($masonryGrid){
                        $masonryGrid.masonry('destroy');
                    }

                    $masonryGrid = $contentList.masonry({
                        columnWidth: 50,
                        itemSelector: '.grid-item'

                    });
                    $masonryGrid.imagesLoaded().progress( function() {
                        $masonryGrid.masonry('layout');
                    });

                }
            });
        }

        function deleteRow(id){

        }


        /**
         * EVENT
         * */
        $('#addDefaultModal').on('hide.bs.modal', function (e) {

        });

        $('#addDefaultModal').on('hidden.bs.modal', function (e) {
            $('.qq-upload-list-selector').empty();
            $mainGrid.ajax.reload();
        });

        $('#deleteRowModal').on('hide.bs.modal', function (e) {
            $(this).removeData('id');
        })
        .on('show.bs.modal', function (e) {
            $(this).data('id', $(e.relatedTarget).data('id'));
        });



        var uploader = new qq.FineUploader({
            debug: false,
            element: document.getElementById('fine-uploader'),
            request: {
                endpoint: '/content/new'
            },
            callbacks: {
                onAllComplete: function (succeeded, failed) {
                    console.log(succeeded);
                }
            },
            validation: {
                allowedExtensions: ['jpeg', 'jpg', 'png', 'gif', 'txt', 'mp4', 'avi', 'wmv'],
                //itemLimit: 3,
                //sizeLimit: 51200 // 50 kB = 50 * 1024 bytes
            }

        });

        $mainGrid = $('#dataTable').DataTable({
            "processing": true,
            "serverSide": true,
            "info": true,
            stateSave: true,
            "ajax": {
                url: "/api/content/list",
                "data": function (d) {
                    var info = $('#dataTable').DataTable().page.info();
                    return {
                        draw: d.draw,
                        page: info.page,
                        length: info.length
                    }
                },

            },
            columnDefs: [
                {
                    "targets": [0, 1],
                    "render": function (data, type, row) {
                        return '<a href="/client/' + row.id + '">' + data + '</a>';
                    },
                },
                {
                    "targets": [3],
                    "className": "dt-body-center",
                    "render": function ( data, type, row ) {
                        return '<img style="width:50px;" src="/upload'+ data + '" />';
                    },
                },
                {
                    "targets": -1,
                    "render": function ( data, type, row ) {

                        return '<div class="dropdown">' +
                            '<button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
                            'Action' +
                            '</button>' +
                            '<div class="dropdown-menu animated--fade-in" aria-labelledby="dropdownMenuButton" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">' +
                            '<a class="dropdown-item" href="#" data-id="'+  data.id +'" data-toggle="modal" data-target="#deleteRowModal">Delete</a>' +
                            '<a class="dropdown-item" href="#">Another action</a>' +
                            '<a class="dropdown-item" href="#">Something else here</a>' +
                            '</div>' +
                            '</div>';
                    },
                    //"defaultContent":
                }
            ],
            "columns": [
                {
                    "data": "id"
                },
                {"data": "name"},
                {"data": "contentType"},
                {"data": "thumbnailPath"},
                {"data": "playTime"},
                {"data": "size"},
                {"data": null},


            ]

        });

        $(document).ready(function () {

        });

    </script>



</div>



</body>
</html>
